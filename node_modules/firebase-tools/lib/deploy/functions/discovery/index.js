"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.discoverBackendSpec = void 0;
const error_1 = require("../../../error");
const logger_1 = require("../../../logger");
const jsTriggerParsing = require("./jsexports/parseTriggers");
const STRATEGIES = [
    {
        name: "parseJSExports",
        useStrategy: jsTriggerParsing.useStrategy,
        discoverBackend: jsTriggerParsing.discoverBackend,
    },
];
async function discoverBackendSpec(context, options, runtimeConfigValues) {
    let strategy = undefined;
    for (const testStrategy of STRATEGIES) {
        if (await testStrategy.useStrategy(context)) {
            strategy = testStrategy;
            break;
        }
    }
    if (strategy) {
        logger_1.logger.debug("Analyizing backend with strategy", strategy.name);
    }
    else {
        throw new error_1.FirebaseError("Cannot determine how to analyze backend");
    }
    return strategy.discoverBackend(context, options, runtimeConfigValues);
}
exports.discoverBackendSpec = discoverBackendSpec;
